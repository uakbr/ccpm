---
name: Implement reprompt logic
status: open
created: 2025-08-21T09:58:41Z
updated: 2025-08-21T10:49:39Z
github: https://github.com/uakbr/ccpm/issues/35
depends_on: [032, 033]
parallel: false
conflicts_with: []
---

# Implement reprompt logic

## Description
Create an intelligent reprompt system that handles unclear speech input by asking clarifying questions and guiding users through successful interaction completion.

## Acceptance Criteria
- [ ] Contextual reprompt generation based on confidence scores and parsing failures
- [ ] Progressive clarification strategy (specific to general questions)
- [ ] Maximum reprompt attempts with graceful fallback
- [ ] Reprompt message personalization and natural language variety
- [ ] Integration with conversation state management
- [ ] Analytics tracking for reprompt effectiveness

## Technical Details
- Implement reprompt trigger conditions:
  - Low ASR confidence scores
  - Parser failures or ambiguous results
  - Missing required information
  - Conflicting or impossible requests
- Develop reprompt message templates:
  - Specific clarification requests
  - Alternative phrasing suggestions
  - Constraint explanation (e.g., "We're closed on Sundays")
- Create progressive reprompt strategy:
  - First attempt: Specific clarification
  - Second attempt: Broader question with examples
  - Third attempt: Offer human assistance or alternative channels
- Implement conversation context retention during reprompts
- Add reprompt analytics and optimization

## Dependencies
- Confidence scoring system (032)
- Speech input parser (033)
- Conversation state management
- Text-to-speech system for voice responses

## Effort Estimate
**Size: M (8-16 hours)**
- Reprompt logic development: 4-6 hours
- Message template system: 2-3 hours
- Context integration: 2-3 hours
- Testing and optimization: 2-4 hours

## Definition of Done
- Reprompt system triggers appropriately for unclear input
- Clarifying questions are contextual and helpful
- Progressive reprompt strategy reduces user frustration
- Maximum attempt limits prevent infinite loops
- Reprompt effectiveness is tracked and measurable
- Integration with voice output system is complete
